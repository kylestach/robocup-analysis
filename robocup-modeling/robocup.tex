\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{nomencl}

\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}

\makenomenclature{}

\nomenclature{$q_w$}{The robot's pose $(x, y, \theta)$, in the world's reference frame.}
\nomenclature{$\dot{q_w}$}{The robot's velocity in the world's reference frame.}
\nomenclature{$\dot{q_b}$}{The robot's velocity in the fixed reference frame currently coinciding with the robot.}
\nomenclature{$w$}{The vector of wheel velocities in $\R^4$.}
\nomenclature{$G$}{The $4 \times 3$ matrix transforming robot-space velocities to wheel-space velocities.}
\nomenclature{$R(q_w)$}{The rotation matrix transforming robot-space velocities to world-space velocities.}
\nomenclature{$M$}{The mass matrix of the robot.}
\nomenclature{$J_w$}{The effective moment of inertia of the wheel, rotor, and geartrain, taken at the wheel (output side of the gearbox).}
\nomenclature{$Q$}{The total effective mass matrix of the robot, combining robot mass and wheel inertia.}

\begin{document}

\printnomenclature{}

State
\begin{align*}
    q_w &= \begin{pmatrix}
        x \\ y \\ \theta
    \end{pmatrix} \\
    \dot{q_w} &= \frac{dq_w}{dt} \\
    \dot{q_w} &= R\dot{q_b} \\
    w &= G\dot{q_b} \\
    Q &= M + G^TJ_wG
\end{align*}

Then, the kinetic energy of the system can be written as follows:
\[KE = \frac{1}{2}\dot{q_b}^{T}(M + G^{T}J_{w}G)\dot{q_b}\]
Or, in terms of world-space velocities:
\[KE = \frac{1}{2}\dot{q_w}^{T}R{(q_w)}^{T}{(M + G^{T}J_{w}G)}R{(q_w)}\dot{q_w}\]
Potential energy is uniformly zero. Then, the Lagrangian is just the system's kinetic energy: $L(q_w, \dot{q_w}) = KE$. By Lagrangian mechanics:
\[\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q_w}}\right) = \frac{\partial L}{\partial q_w}\]
\[\frac{d}{dt}\left(R{(q_w)}^{T}QR{(q_w)}\dot{q_w}\right) = \frac{\partial L}{\partial q_w}\]
\[\frac{d}{dt}\left(R{(q_w)}^{T}QR{(q_w)}\dot{q_w}\right) = \frac{1}{2}\dot{q_w}^T\left(
        R_{q_w}{(q_w)}^TQR{(q_w)} + R{(q_w)}^TQR_{q_w}{(q_w)}
    \right)\dot{q_w}\]

\[R{(q_w)}^{T}QR{(q_w)}\ddot{q_w} + \dot{R}(q_w)^TQR(q_w)\dot{q_w} + R(q_w)^TQ\dot{R}(q_w)\dot{q_w} = 0\]

\end{document}
